 generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
   
}

model Usuario {
  id        Int         @id @default(autoincrement())
  nombre    String
  email     String      @unique
  password  String
  rol       String      @default("OPERARIO")
  historial Historial[]
}

model Producto {
  id            Int      @id @default(autoincrement())
  nombre        String
  codigoBarras  String?  @unique
  qrCode        String?  @unique
  descripcion   String?
  cantidadTotal Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  ubicaciones AsignacionProductoUbicacion[]
  historial   Historial[]
}

model Ubicacion {
  id          Int    @id @default(autoincrement())
  pasillo     Int
  lado        String
  letra       String
  nivel       Int
  nombre      String @unique
  coordenadaX Int
  coordenadaY Int
  ancho       Int    @default(60)
  alto        Int    @default(40)

  productos        AsignacionProductoUbicacion[]
  historialOrigen  Historial[]                   @relation("HistorialUbicacionOrigen")
  historialDestino Historial[]                   @relation("HistorialUbicacionDestino")
}

model AsignacionProductoUbicacion {
  id          Int @id @default(autoincrement())
  productoId  Int
  ubicacionId Int
  cantidad    Int @default(1)

  producto  Producto  @relation(fields: [productoId], references: [id], onDelete: Cascade)
  ubicacion Ubicacion @relation(fields: [ubicacionId], references: [id], onDelete: Cascade)

  @@unique([productoId, ubicacionId])
}

model Historial {
  id                Int      @id @default(autoincrement())
  productoId        Int
  accion            String
  cantidad          Int
  ubicacionAnterior Int?
  ubicacionNueva    Int?
  usuarioId         Int
  fecha             DateTime @default(now())

  producto Producto @relation(fields: [productoId], references: [id])
  usuario  Usuario  @relation(fields: [usuarioId], references: [id])

  ubicacionOrigen  Ubicacion? @relation("HistorialUbicacionOrigen", fields: [ubicacionAnterior], references: [id])
  ubicacionDestino Ubicacion? @relation("HistorialUbicacionDestino", fields: [ubicacionNueva], references: [id])
}
